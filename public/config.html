<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust-Cool-Nginx - æœåŠ¡å™¨é…ç½®</title>
    <style>
        :root {
            --primary: #0ff;
            --secondary: #f0f;
            --dark: #0a0a1a;
            --darker: #050510;
            --light: #fff;
            --gray: #ccc;
            --gradient-start: #00dbde;
            --gradient-end: #fc00ff;
            --success: #0f0;
            --danger: #f00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(10, 10, 30, 0.8);
            padding: 15px 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-decoration: none;
        }

        .navbar-nav {
            display: flex;
            list-style: none;
        }

        .nav-item {
            margin-left: 20px;
        }

        .nav-link {
            color: var(--gray);
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--primary);
            background: rgba(0, 255, 255, 0.1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .page-header p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .card {
            background: rgba(10, 10, 30, 0.8);
            border-radius: 10px;
            padding: 25px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .card-title i {
            margin-right: 10px;
            font-size: 1.8rem;
        }

        .config-display {
            display: grid;
            gap: 15px;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-key {
            color: var(--gray);
        }

        .config-value {
            font-weight: 500;
        }

        .config-value.enabled {
            color: var(--success);
        }

        .config-value.disabled {
            color: var(--danger);
        }

        .message {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .message.success {
            background: rgba(0, 100, 0, 0.3);
            border: 1px solid var(--success);
            color: var(--success);
            display: block;
        }

        .message.error {
            background: rgba(100, 0, 0, 0.3);
            border: 1px solid var(--danger);
            color: var(--danger);
            display: block;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 5px;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 219, 222, 0.4);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            border-top: 1px solid rgba(0, 255, 255, 0.1);
        }
        
        .actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a class="navbar-brand" href="/">Rust-Cool-Nginx</a>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">é¦–é¡µ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="config.html">é…ç½®</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="status.html">ç›‘æ§</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="static-file.html">é™æ€æ–‡ä»¶</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>æœåŠ¡å™¨é…ç½®</h1>
            <p>æŸ¥çœ‹ Rust-Cool-Nginx æœåŠ¡å™¨é…ç½®</p>
        </div>

        <div id="message" class="message"></div>

        <div class="card">
            <h2 class="card-title">
                <span>ğŸ“‹</span> å½“å‰é…ç½®
            </h2>
            <div class="config-display">
                <div class="config-item">
                    <div class="config-key">ç›‘å¬åœ°å€:</div>
                    <div class="config-value" id="listen_addr_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">åç«¯åœ°å€:</div>
                    <div class="config-value" id="backend_addr_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">é™æ€æ–‡ä»¶æ ¹ç›®å½•:</div>
                    <div class="config-value" id="static_root_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">è®¿é—®æ—¥å¿—:</div>
                    <div class="config-value" id="access_log_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">é”™è¯¯æ—¥å¿—:</div>
                    <div class="config-value" id="error_log_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">æ—¥å¿—çº§åˆ«:</div>
                    <div class="config-value" id="log_level_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">SSLè¯ä¹¦è·¯å¾„:</div>
                    <div class="config-value" id="ssl_cert_path_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">SSLå¯†é’¥è·¯å¾„:</div>
                    <div class="config-value" id="ssl_key_path_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">SSLå¯ç”¨:</div>
                    <div class="config-value" id="ssl_enabled_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">é™æ€æ–‡ä»¶æœåŠ¡:</div>
                    <div class="config-value" id="static_file_serving_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">åå‘ä»£ç†:</div>
                    <div class="config-value" id="reverse_proxy_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">FastCGI æ”¯æŒ:</div>
                    <div class="config-value" id="fastcgi_support_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">è®¿é—®æ§åˆ¶:</div>
                    <div class="config-value" id="access_control_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">è¯·æ±‚é¢‘ç‡é™åˆ¶:</div>
                    <div class="config-value" id="rate_limiting_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">SSL/TLS:</div>
                    <div class="config-value" id="ssl_tls_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">è´Ÿè½½å‡è¡¡:</div>
                    <div class="config-value" id="load_balancing_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">è´Ÿè½½å‡è¡¡ç®—æ³•:</div>
                    <div class="config-value" id="load_balancing_algorithm_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ä¸Šæ¸¸æœåŠ¡å™¨æ•°é‡:</div>
                    <div class="config-value" id="upstream_servers_count">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ä¸Šæ¸¸æœåŠ¡å™¨è¯¦æƒ…:</div>
                    <div class="config-value" id="upstream_servers_details">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ç¼“å­˜æœºåˆ¶:</div>
                    <div class="config-value" id="caching_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ç¼“å­˜è·¯å¾„:</div>
                    <div class="config-value" id="cache_path_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ç¼“å­˜æœ€å¤§å¤§å°:</div>
                    <div class="config-value" id="cache_max_size_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ç¼“å­˜éæ´»åŠ¨æ—¶é—´:</div>
                    <div class="config-value" id="cache_inactive_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">Gzip å‹ç¼©:</div>
                    <div class="config-value" id="gzip_compression_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">Gzip å‹ç¼©çº§åˆ«:</div>
                    <div class="config-value" id="gzip_comp_level_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">Gzip æœ€å°é•¿åº¦:</div>
                    <div class="config-value" id="gzip_min_length_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">è™šæ‹Ÿä¸»æœº:</div>
                    <div class="config-value" id="virtual_hosts_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">WebSocket æ”¯æŒ:</div>
                    <div class="config-value" id="websocket_support_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">å·¥ä½œè¿›ç¨‹æ•°:</div>
                    <div class="config-value" id="worker_processes_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">å·¥ä½œè¿æ¥æ•°:</div>
                    <div class="config-value" id="worker_connections_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ç›‘æ§å¯ç”¨:</div>
                    <div class="config-value" id="monitoring_enabled_display">-</div>
                </div>
                <div class="config-item">
                    <div class="config-key">ç»Ÿè®¡è·¯å¾„:</div>
                    <div class="config-value" id="stats_path_display">-</div>
                </div>
            </div>
            
            <div class="actions">
                <button type="button" class="btn btn-primary" id="edit-config-btn">ç¼–è¾‘é…ç½®</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Â© 2025 Rust-Cool-Nginx - é«˜æ€§èƒ½ Web æœåŠ¡å™¨ | åŸºäº Rust å’Œ Tokio æ„å»º</p>
        </div>
    </footer>

    <script>
        // æ£€æŸ¥æ˜¯å¦åœ¨ Tauri ç¯å¢ƒä¸­è¿è¡Œ
        var isTauri = false;
        
        // é€šè¿‡APIè·å–å®é™…çš„é…ç½®ä¿¡æ¯
        async function loadConfig() {
            console.log('å¼€å§‹åŠ è½½é…ç½®...');
            console.log('isTauri:', isTauri);
            
            // æ— è®ºæ˜¯å¦æ£€æµ‹åˆ° Tauri ç¯å¢ƒï¼Œéƒ½å°è¯•å¤šç§æ–¹å¼è·å–é…ç½®
            try {
                let config;
                
                // é¦–å…ˆå°è¯• Tauri æ–¹å¼
                if (isTauri && window.__TAURI__) {
                    console.log('åœ¨Tauriç¯å¢ƒä¸­ï¼Œå°è¯•è°ƒç”¨Tauriå‘½ä»¤');
                    try {
                        // å°è¯•ä¸åŒçš„ Tauri API è°ƒç”¨æ–¹å¼
                        if (window.__TAURI__.core && typeof window.__TAURI__.core.invoke === 'function') {
                            console.log('ä½¿ç”¨ window.__TAURI__.core.invoke æ–¹æ³•');
                            config = await window.__TAURI__.core.invoke('get_config');
                        } else if (typeof window.__TAURI__.invoke === 'function') {
                            console.log('ä½¿ç”¨ window.__TAURI__.invoke æ–¹æ³•');
                            config = await window.__TAURI__.invoke('get_config');
                        } else if (window.__TAURI__.tauri && typeof window.__TAURI__.tauri.invoke === 'function') {
                            console.log('ä½¿ç”¨ window.__TAURI__.tauri.invoke æ–¹æ³•');
                            config = await window.__TAURI__.tauri.invoke('get_config');
                        } else {
                            throw new Error('æœªæ‰¾åˆ°æœ‰æ•ˆçš„ Tauri è°ƒç”¨æ–¹æ³•');
                        }
                        console.log('é€šè¿‡Tauriè·å–åˆ°çš„é…ç½®:', config);
                    } catch (tauriError) {
                        console.error('Tauriè°ƒç”¨å¤±è´¥:', tauriError);
                        throw tauriError;
                    }
                } else {
                    // å¦‚æœä¸æ˜¯ Tauri ç¯å¢ƒæˆ– Tauri å¯¹è±¡ä¸å­˜åœ¨ï¼Œå°è¯•é€šè¿‡ HTTP API è·å–é…ç½®
                    console.log('é€šè¿‡HTTP APIè·å–é…ç½®');
                    // æ„å»ºæ­£ç¡®çš„APIåœ°å€
                    let apiUrl;
                    if (window.location.origin === 'http://tauri.localhost') {
                        // åœ¨ Tauri ç¯å¢ƒä¸­ï¼Œåç«¯è¿è¡Œåœ¨ 127.0.0.1:80
                        apiUrl = 'http://127.0.0.1:80/api/config';
                    } else {
                        // åœ¨ Web ç¯å¢ƒä¸­ï¼Œä½¿ç”¨å½“å‰åŸŸåå’Œç«¯å£
                        apiUrl = `${window.location.origin}/api/config`;
                    }
                    console.log('API URL:', apiUrl);
                    
                    const response = await fetch(apiUrl);
                    const contentType = response.headers.get('content-type');
                    
                    if (contentType && contentType.includes('application/json')) {
                        // æ£€æŸ¥å“åº”æ˜¯å¦ä¸º JSON æ ¼å¼
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        config = await response.json();
                        console.log('é€šè¿‡HTTP APIè·å–åˆ°çš„é…ç½®:', config);
                    } else {
                        // å¦‚æœå“åº”ä¸æ˜¯ JSON æ ¼å¼ï¼ŒæŠ›å‡ºé”™è¯¯
                        const text = await response.text();
                        console.log('HTTP API å“åº”å†…å®¹:', text);
                        console.error('HTTP API è¿”å›é JSON å“åº”:', text.substring(0, 100) + '...');
                        throw new Error('HTTP API è¿”å›é JSON å“åº”');
                    }
                }
                
                // å¡«å……é…ç½®æ˜¾ç¤ºåŒºåŸŸ
                populateConfigDisplay(config);
                return config;
            } catch (error) {
                console.error('è·å–é…ç½®ä¿¡æ¯å¤±è´¥:', error);
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                showMessage('åŠ è½½é…ç½®ä¿¡æ¯å¤±è´¥: ' + error.message, 'error');
                
                // æä¾›é»˜è®¤é…ç½®ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
                console.log('ä½¿ç”¨é»˜è®¤é…ç½®');
                const defaultConfig = {
                    server: {
                        listen_addr: '127.0.0.1:80',
                        backend_addr: '',
                        static_root: './public'
                    },
                    upstream: {
                        load_balancing_algorithm: 'round_robin',
                        servers: []
                    },
                    features: {
                        static_file_serving: true,
                        reverse_proxy: true,
                        fastcgi_support: false,
                        load_balancing: false,
                        cache_enabled: false,
                        gzip_compression: false,
                        virtual_hosts: false,
                        access_control: false,
                        rate_limiting: false,
                        ssl_tls: false,
                        websocket_support: true,
                        monitoring_enabled: true,
                        stats_path: '/nginx_status'
                    }
                };
                
                // å¡«å……é»˜è®¤é…ç½®
                populateConfigDisplay(defaultConfig);
                return defaultConfig;
            }
        }
        
        // å¡«å……é…ç½®æ˜¾ç¤ºåŒºåŸŸ
        function populateConfigDisplay(config) {
            console.log('å¡«å……æ˜¾ç¤ºåŒºåŸŸæ•°æ®:', config);
            try {
                // æœåŠ¡å™¨é…ç½®
                document.getElementById('listen_addr_display').textContent = config.server.listen_addr || '127.0.0.1:80';
                document.getElementById('backend_addr_display').textContent = config.server.backend_addr || 'æœªè®¾ç½®';
                document.getElementById('static_root_display').textContent = config.server.static_root || './public';
                document.getElementById('access_log_display').textContent = config.server.access_log || './logs/access.log';
                document.getElementById('error_log_display').textContent = config.server.error_log || './logs/error.log';
                document.getElementById('log_level_display').textContent = config.server.log_level || 'info';
                document.getElementById('ssl_cert_path_display').textContent = config.server.ssl_cert_path || 'æœªè®¾ç½®';
                document.getElementById('ssl_key_path_display').textContent = config.server.ssl_key_path || 'æœªè®¾ç½®';
                document.getElementById('ssl_enabled_display').textContent = config.server.ssl_enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('ssl_enabled_display').className = 'config-value ' + (config.server.ssl_enabled ? 'enabled' : 'disabled');
                
                // åŸºæœ¬ HTTP æœåŠ¡
                document.getElementById('static_file_serving_display').textContent = config.features.static_file_serving ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('static_file_serving_display').className = 'config-value ' + (config.features.static_file_serving ? 'enabled' : 'disabled');
                
                document.getElementById('reverse_proxy_display').textContent = config.features.reverse_proxy ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('reverse_proxy_display').className = 'config-value ' + (config.features.reverse_proxy ? 'enabled' : 'disabled');
                
                document.getElementById('fastcgi_support_display').textContent = config.features.fastcgi_support ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('fastcgi_support_display').className = 'config-value ' + (config.features.fastcgi_support ? 'enabled' : 'disabled');
                
                // å®‰å…¨ç‰¹æ€§
                document.getElementById('access_control_display').textContent = config.features.access_control ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('access_control_display').className = 'config-value ' + (config.features.access_control ? 'enabled' : 'disabled');
                
                document.getElementById('rate_limiting_display').textContent = config.features.rate_limiting ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('rate_limiting_display').className = 'config-value ' + (config.features.rate_limiting ? 'enabled' : 'disabled');
                
                document.getElementById('ssl_tls_display').textContent = config.features.ssl_tls ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('ssl_tls_display').className = 'config-value ' + (config.features.ssl_tls ? 'enabled' : 'disabled');
                
                // å…¶ä»–åŠŸèƒ½
                document.getElementById('load_balancing_display').textContent = config.features.load_balancing ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('load_balancing_display').className = 'config-value ' + (config.features.load_balancing ? 'enabled' : 'disabled');
                
                document.getElementById('caching_display').textContent = config.features.cache_enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('caching_display').className = 'config-value ' + (config.features.cache_enabled ? 'enabled' : 'disabled');
                
                document.getElementById('gzip_compression_display').textContent = config.features.gzip_compression ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('gzip_compression_display').className = 'config-value ' + (config.features.gzip_compression ? 'enabled' : 'disabled');
                
                document.getElementById('virtual_hosts_display').textContent = config.features.virtual_hosts ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('virtual_hosts_display').className = 'config-value ' + (config.features.virtual_hosts ? 'enabled' : 'disabled');
                
                document.getElementById('websocket_support_display').textContent = config.features.websocket_support ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('websocket_support_display').className = 'config-value ' + (config.features.websocket_support ? 'enabled' : 'disabled');
                
                // ç¼“å­˜é…ç½®
                document.getElementById('cache_path_display').textContent = config.features.cache_path || 'æœªè®¾ç½®';
                document.getElementById('cache_max_size_display').textContent = config.features.cache_max_size || 'æœªè®¾ç½®';
                document.getElementById('cache_inactive_display').textContent = config.features.cache_inactive || 'æœªè®¾ç½®';
                
                // Gzipé…ç½®
                document.getElementById('gzip_comp_level_display').textContent = config.features.gzip_comp_level || 'æœªè®¾ç½®';
                document.getElementById('gzip_min_length_display').textContent = config.features.gzip_min_length || 'æœªè®¾ç½®';
                
                // å·¥ä½œè¿›ç¨‹é…ç½®
                document.getElementById('worker_processes_display').textContent = config.features.worker_processes || 'æœªè®¾ç½®';
                document.getElementById('worker_connections_display').textContent = config.features.worker_connections || 'æœªè®¾ç½®';
                
                // ç›‘æ§é…ç½®
                document.getElementById('monitoring_enabled_display').textContent = config.features.monitoring_enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                document.getElementById('monitoring_enabled_display').className = 'config-value ' + (config.features.monitoring_enabled ? 'enabled' : 'disabled');
                document.getElementById('stats_path_display').textContent = config.features.stats_path || '/nginx_status';
                
                // è´Ÿè½½å‡è¡¡é…ç½®
                document.getElementById('load_balancing_algorithm_display').textContent = getLoadBalancingAlgorithmName(config.upstream.load_balancing_algorithm) || 'è½®è¯¢';
                document.getElementById('upstream_servers_count').textContent = config.upstream.servers ? config.upstream.servers.length : 0;
                
                // æ˜¾ç¤ºä¸Šæ¸¸æœåŠ¡å™¨è¯¦æƒ…
                if (config.upstream.servers && Array.isArray(config.upstream.servers) && config.upstream.servers.length > 0) {
                    let serversDetails = '';
                    config.upstream.servers.forEach((server, index) => {
                        serversDetails += `æœåŠ¡å™¨${index + 1}: ${server.address || 'æœªè®¾ç½®'}\n`;
                        if (server.weight) serversDetails += `  æƒé‡: ${server.weight}\n`;
                        if (server.max_fails) serversDetails += `  æœ€å¤§å¤±è´¥æ¬¡æ•°: ${server.max_fails}\n`;
                        if (server.fail_timeout) serversDetails += `  å¤±è´¥è¶…æ—¶: ${server.fail_timeout}\n`;
                        serversDetails += '\n';
                    });
                    document.getElementById('upstream_servers_details').textContent = serversDetails;
                } else {
                    document.getElementById('upstream_servers_details').textContent = 'æœªé…ç½®ä¸Šæ¸¸æœåŠ¡å™¨';
                }
            } catch (e) {
                console.error('å¡«å……æ˜¾ç¤ºåŒºåŸŸæ—¶å‡ºé”™:', e);
                showMessage('å¡«å……æ˜¾ç¤ºåŒºåŸŸæ—¶å‡ºé”™: ' + e.message, 'error');
            }
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                messageEl.className = 'message';
            }, 3000);
        }
        
        // è·å–è´Ÿè½½å‡è¡¡ç®—æ³•åç§°
        function getLoadBalancingAlgorithmName(algorithm) {
            const algorithms = {
                'round_robin': 'è½®è¯¢ (Round Robin)',
                'least_conn': 'æœ€å°‘è¿æ¥ (Least Connections)',
                'ip_hash': 'IPå“ˆå¸Œ (IP Hash)'
            };
            return algorithms[algorithm] || algorithm;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å¢åŠ å»¶è¿Ÿç¡®ä¿ Tauri å®Œå…¨åˆå§‹åŒ–
            setTimeout(function() {
                // æ£€æŸ¥å¤šç§å¯èƒ½çš„ Tauri å¯¹è±¡å­˜åœ¨å½¢å¼
                console.log('æ£€æŸ¥ Tauri ç¯å¢ƒ...');
                console.log('window.__TAURI__:', window.__TAURI__);
                console.log('window.location.protocol:', window.location.protocol);
                
                // æ£€æŸ¥æ˜¯å¦åœ¨ Tauri ç¯å¢ƒä¸­è¿è¡Œ
                if (window.__TAURI__) {
                    console.log('æ£€æµ‹åˆ° window.__TAURI__');
                    isTauri = true;
                    
                    // æ£€æŸ¥å„ç§å¯èƒ½çš„ invoke æ–¹æ³•
                    if (typeof window.__TAURI__.invoke === 'function') {
                        console.log('window.__TAURI__.invoke æ˜¯å‡½æ•°');
                    } else if (window.__TAURI__.core && typeof window.__TAURI__.core.invoke === 'function') {
                        console.log('window.__TAURI__.core.invoke æ˜¯å‡½æ•°');
                    } else if (window.__TAURI__.tauri && typeof window.__TAURI__.tauri.invoke === 'function') {
                        console.log('window.__TAURI__.tauri.invoke æ˜¯å‡½æ•°');
                    } else {
                        console.log('window.__TAURI__ å­˜åœ¨ä½†æ²¡æœ‰æ‰¾åˆ° invoke æ–¹æ³•');
                    }
                } else if (window.location.protocol === 'tauri:') {
                    console.log('æ£€æµ‹åˆ° tauri åè®®ï¼Œæ ‡è®°ä¸º Tauri ç¯å¢ƒ');
                    isTauri = true;
                } else {
                    console.log('æœªæ£€æµ‹åˆ° Tauri ç¯å¢ƒï¼Œå°†ä½¿ç”¨Webæ¨¡å¼');
                    isTauri = false;
                }
                
                console.log('Tauri environment check result:', isTauri);
                
                // å»¶è¿ŸåŠ è½½é…ç½®
                setTimeout(function() {
                    loadConfig();
                }, 100);
            }, 500); // å»¶è¿Ÿ 500ms ç¡®ä¿ Tauri å®Œå…¨åˆå§‹åŒ–
            
            // ç»‘å®šç¼–è¾‘é…ç½®æŒ‰é’®äº‹ä»¶
            document.getElementById('edit-config-btn').addEventListener('click', function() {
                window.location.href = 'edit-config.html';
            });
        });
    </script>
</body>
</html>