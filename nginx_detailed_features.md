# Nginx 详细功能规格说明

## 1. 基本 HTTP 服务

### 1.1 静态文件服务

#### 1.1.1 功能描述
Nginx 可以作为高性能的静态文件服务器，处理各种类型的静态资源请求，包括 HTML、CSS、JavaScript、图片、视频等文件。

#### 1.1.2 核心特性
- **高性能文件传输**：利用异步非阻塞 I/O 模型，支持高并发静态文件请求处理
- **MIME 类型自动识别**：根据文件扩展名自动设置正确的 Content-Type 响应头
- **文件描述符缓冲优化**：通过 sendfile 等系统调用减少内存拷贝，提高传输效率
- **条件请求支持**：支持 If-Modified-Since、If-None-Match 等条件请求头，实现 304 响应

#### 1.1.3 配置选项
- `root`：设置静态文件根目录
- `alias`：设置路径别名，映射 URL 到文件系统路径
- `index`：定义索引文件列表，按顺序查找默认首页
- `try_files`：按顺序检查文件是否存在，支持回退到命名 location
- `location`：定义 URL 匹配规则和对应的处理方式

#### 1.1.4 安全特性
- **目录遍历防护**：防止通过 ../ 等方式访问根目录外的文件
- **权限控制**：基于文件系统权限控制文件访问
- **隐藏敏感文件**：通过配置可以拒绝访问 .htaccess、.git 等敏感文件

### 1.2 反向代理

#### 1.2.1 功能描述
Nginx 可以作为反向代理服务器，将客户端请求转发到后端服务器，并将后端服务器的响应返回给客户端。

#### 1.2.2 核心特性
- **请求转发**：将客户端请求透明地转发到一个或多个后端服务器
- **响应处理**：接收后端服务器的响应并返回给客户端
- **协议支持**：支持 HTTP/1.0、HTTP/1.1、HTTP/2、HTTPS 等协议
- **连接池管理**：维护与后端服务器的连接池，减少连接建立开销

#### 1.2.3 配置选项
- `proxy_pass`：指定后端服务器地址
- `proxy_set_header`：设置转发给后端服务器的请求头
- `proxy_hide_header`：隐藏从后端服务器返回的特定响应头
- `proxy_pass_header`：允许特定响应头传递给客户端
- `proxy_redirect`：修改后端服务器返回的 Location 和 Refresh 头

#### 1.2.4 高级特性
- **缓冲控制**：通过 proxy_buffering、proxy_buffers 等指令控制响应缓冲
- **超时设置**：配置连接、发送、接收等各种超时时间
- **错误处理**：通过 proxy_next_upstream 控制在什么情况下尝试下一个后端服务器

### 1.3 FastCGI 支持

#### 1.3.1 功能描述
Nginx 支持通过 FastCGI 协议与后端应用服务器通信，常用于 PHP、Python 等动态语言的 Web 应用。

#### 1.3.2 核心特性
- **协议兼容**：完全兼容 FastCGI 协议规范
- **参数传递**：将 HTTP 请求信息通过 FastCGI 参数传递给后端应用
- **连接管理**：维护与 FastCGI 进程的连接池
- **负载均衡**：支持多个 FastCGI 后端的负载均衡

#### 1.3.3 配置选项
- `fastcgi_pass`：指定 FastCGI 服务器地址
- `fastcgi_param`：设置传递给 FastCGI 服务器的参数
- `fastcgi_index`：设置 FastCGI 默认索引文件
- `fastcgi_intercept_errors`：是否拦截后端返回的错误状态码

#### 1.3.4 性能优化
- **缓冲控制**：通过 fastcgi_buffering、fastcgi_buffers 等指令优化响应处理
- **keepalive 连接**：通过 fastcgi_keep_conn 指令保持与 FastCGI 服务器的连接

### 1.4 SSL/TLS 支持

#### 1.4.1 功能描述
Nginx 提供完整的 SSL/TLS 支持，可以作为 HTTPS 服务器或 HTTPS 代理。

#### 1.4.2 核心特性
- **协议支持**：支持 SSL 3.0、TLS 1.0、TLS 1.1、TLS 1.2、TLS 1.3
- **证书管理**：支持多种格式的证书和私钥文件
- **密码套件控制**：可以指定允许的加密算法和密钥交换方法
- **会话复用**：支持 SSL 会话缓存和票据（Ticket）机制

#### 1.4.3 配置选项
- `ssl_certificate`：指定 SSL 证书文件路径
- `ssl_certificate_key`：指定 SSL 私钥文件路径
- `ssl_protocols`：指定启用的 SSL/TLS 协议版本
- `ssl_ciphers`：指定允许的密码套件列表
- `ssl_session_cache`：配置 SSL 会话缓存
- `ssl_session_timeout`：设置 SSL 会话超时时间

#### 1.4.4 安全增强
- **OCSP 装订**：通过 ssl_stapling 和 ssl_stapling_verify 支持 OCSP 装订
- **HSTS 支持**：通过 add_header 指令添加 Strict-Transport-Security 头
- **客户端证书验证**：支持客户端证书认证

## 2. 高级 HTTP 服务

### 2.1 负载均衡

#### 2.1.1 功能描述
Nginx 提供多种负载均衡算法，可以在多个后端服务器之间分发请求。

#### 2.1.2 负载均衡算法
- **轮询（Round Robin）**：默认算法，按顺序将请求分发给后端服务器
- **加权轮询（Weighted Round Robin）**：根据权重分配请求，权重高的服务器接收更多请求
- **IP 哈希（IP Hash）**：根据客户端 IP 地址进行哈希计算，确保同一 IP 的请求总是转发到同一台服务器
- **最少连接（Least Connections）**：将请求转发给当前连接数最少的服务器
- **通用哈希（Generic Hash）**：根据用户定义的键进行哈希计算

#### 2.1.3 配置选项
- `upstream`：定义后端服务器组
- `server`：在 upstream 块中定义具体的后端服务器
- `weight`：设置服务器权重
- `max_fails`：设置在 fail_timeout 时间内最大失败次数
- `fail_timeout`：设置服务器被认为不可用的时间

#### 2.1.4 健康检查
- **被动健康检查**：通过 max_fails 和 fail_timeout 实现
- **主动健康检查**：通过第三方模块实现 HTTP 或 TCP 层的主动健康检查

### 2.2 缓存机制

#### 2.2.1 功能描述
Nginx 提供多种缓存机制，可以缓存后端服务器的响应，减少后端负载并提高响应速度。

#### 2.2.2 缓存类型
- **HTTP 缓存（proxy_cache）**：缓存反向代理的响应
- **FastCGI 缓存（fastcgi_cache）**：缓存 FastCGI 服务器的响应
- **uWSGI 缓存（uwsgi_cache）**：缓存 uWSGI 服务器的响应
- **SCGI 缓存（scgi_cache）**：缓存 SCGI 服务器的响应

#### 2.2.3 核心特性
- **缓存键自定义**：可以根据 URI、请求头、参数等构建缓存键
- **过期策略**：支持基于 Cache-Control、Expires 头或配置指令的过期控制
- **缓存清理**：支持通过第三方模块或直接删除缓存文件进行缓存清理
- **部分缓存**：支持只缓存特定状态码或特定内容类型的响应

#### 2.2.4 配置选项
- `proxy_cache_path`：定义缓存路径、层级、大小等参数
- `proxy_cache`：指定使用的缓存区域
- `proxy_cache_valid`：设置不同响应状态码的缓存时间
- `proxy_cache_key`：定义缓存键的构建方式
- `proxy_cache_use_stale`：在后端不可用时使用过期缓存

### 2.3 压缩和优化

#### 2.3.1 功能描述
Nginx 支持对响应内容进行压缩，减少传输数据量，提高页面加载速度。

#### 2.3.2 压缩算法
- **Gzip 压缩**：支持标准的 gzip 压缩算法
- **Brotli 压缩**：通过第三方模块支持更高效的 Brotli 压缩算法

#### 2.3.3 核心特性
- **内容类型过滤**：只对特定类型的内容进行压缩
- **最小长度控制**：不压缩过小的响应内容
- **HTTP 版本控制**：只对 HTTP/1.1 及以上版本的请求进行压缩
- **客户端支持检测**：根据 Accept-Encoding 头判断客户端是否支持压缩

#### 2.3.4 配置选项
- `gzip`：启用或禁用 gzip 压缩
- `gzip_types`：指定需要压缩的 MIME 类型
- `gzip_min_length`：设置需要压缩的最小响应长度
- `gzip_comp_level`：设置压缩级别（1-9）
- `gzip_vary`：添加 Vary: Accept-Encoding 响应头

### 2.4 虚拟主机

#### 2.4.1 功能描述
Nginx 支持基于域名、IP 地址或端口的虚拟主机，可以在同一台服务器上托管多个网站。

#### 2.4.2 虚拟主机类型
- **基于域名的虚拟主机**：通过 server_name 指令匹配不同的域名
- **基于 IP 的虚拟主机**：通过 listen 指令绑定到不同的 IP 地址
- **基于端口的虚拟主机**：通过 listen 指令监听不同的端口

#### 2.4.3 匹配规则
- **精确匹配**：完全匹配的 server_name
- **通配符匹配**：支持前缀或后缀通配符（如 *.example.com）
- **正则表达式匹配**：使用 ~ 开头的正则表达式进行匹配
- **默认服务器**：通过 default_server 参数指定默认虚拟主机

### 2.5 URL 处理

#### 2.5.1 功能描述
Nginx 提供强大的 URL 处理能力，可以重写 URL、重定向请求、进行内部转发等。

#### 2.5.2 核心功能
- **URL 重写（Rewrite）**：根据规则修改请求 URI
- **URL 重定向（Redirect）**：返回 301、302 等重定向响应
- **内部重定向**：通过 rewrite 指令进行内部请求转发
- **条件重写**：根据变量值进行条件判断和重写

#### 2.5.3 配置指令
- `rewrite`：定义重写规则
- `return`：返回指定状态码和内容
- `redirect`：返回 302 临时重定向
- `permanent`：返回 301 永久重定向

### 2.6 访问控制

#### 2.6.1 功能描述
Nginx 提供多种访问控制机制，可以限制客户端对资源的访问。

#### 2.6.2 访问控制类型
- **基于 IP 的访问控制**：通过 allow 和 deny 指令控制 IP 访问
- **HTTP 基本认证**：通过 auth_basic 模块实现用户名/密码认证
- **子请求认证**：通过 auth_request 模块实现基于子请求的认证
- **访问密钥限制**：通过 secure_link 模块实现基于时间戳和哈希的访问控制

#### 2.6.3 配置选项
- `allow`：允许指定 IP 地址或网段访问
- `deny`：拒绝指定 IP 地址或网段访问
- `auth_basic`：启用基本认证并设置提示信息
- `auth_basic_user_file`：指定存储用户名/密码的文件路径

### 2.7 日志功能

#### 2.7.1 功能描述
Nginx 提供详细的日志记录功能，可以记录访问日志和错误日志。

#### 2.7.2 日志类型
- **访问日志（Access Log）**：记录每个 HTTP 请求的详细信息
- **错误日志（Error Log）**：记录服务器运行过程中的错误和警告信息

#### 2.7.3 核心特性
- **自定义日志格式**：通过 log_format 指令定义日志格式
- **条件日志记录**：根据条件决定是否记录日志
- **日志缓冲**：通过缓冲机制提高日志写入性能
- **日志轮转**：支持外部工具进行日志轮转

#### 2.7.4 配置选项
- `log_format`：定义日志格式
- `access_log`：配置访问日志路径和格式
- `error_log`：配置错误日志路径和级别
- `open_log_file_cache`：启用日志文件描述符缓存

### 2.8 连接处理

#### 2.8.1 功能描述
Nginx 提供多种连接处理机制，支持高并发连接处理。

#### 2.8.2 连接类型
- **HTTP/1.0 Keep-Alive**：支持持久连接，减少连接建立开销
- **HTTP/1.1 管线化连接**：支持请求管线化，提高传输效率
- **HTTP/2 支持**：支持二进制协议、多路复用等 HTTP/2 特性
- **SPDY 支持**：支持 Google 的 SPDY 协议（旧版本）

#### 2.8.3 配置选项
- `keepalive_timeout`：设置 Keep-Alive 连接超时时间
- `keepalive_requests`：设置单个连接上允许的最大请求数
- `http2_max_field_size`：设置 HTTP/2 最大字段大小
- `http2_max_header_size`：设置 HTTP/2 最大头部大小

### 2.9 流媒体支持

#### 2.9.1 功能描述
Nginx 提供流媒体传输支持，可以高效地传输视频和音频文件。

#### 2.9.2 核心特性
- **FLV 视频流媒体传输**：通过 http_flv_module 支持 FLV 视频流传输
- **MP4 视频流媒体传输**：通过 http_mp4_module 支持 MP4 视频流传输
- **伪流媒体支持**：支持随机访问视频文件的任意位置

#### 2.9.3 配置选项
- `flv`：启用 FLV 流媒体支持
- `mp4`：启用 MP4 流媒体支持
- `mp4_buffer_size`：设置 MP4 文件的初始缓冲区大小
- `mp4_max_buffer_size`：设置 MP4 文件的最大缓冲区大小

## 3. 高可用性和可靠性

### 3.1 热部署

#### 3.1.1 功能描述
Nginx 支持热部署机制，可以在不中断服务的情况下更新配置或升级程序。

#### 3.1.2 核心特性
- **配置文件热重载**：通过 reload 命令重新加载配置文件
- **在线二进制升级**：支持在不中断服务的情况下升级 Nginx 程序
- **无缝配置更新**：新配置立即生效，不影响现有连接

#### 3.1.3 操作方法
- `nginx -s reload`：重新加载配置文件
- `nginx -s upgrade`：升级 Nginx 程序
- `nginx -s reopen`：重新打开日志文件

### 3.2 进程模型

#### 3.2.1 功能描述
Nginx 采用多进程模型，通过主进程和工作进程协同工作来处理请求。

#### 3.2.2 进程类型
- **主进程（Master Process）**：负责管理工作进程、读取配置、绑定端口等
- **工作进程（Worker Processes）**：负责处理网络请求，通常设置为 CPU 核心数

#### 3.2.3 进程管理
- **进程间独立性**：工作进程相互独立，一个进程崩溃不影响其他进程
- **主进程监控**：主进程监控工作进程状态，自动重启失败的工作进程
- **信号处理**：通过信号机制控制进程行为

#### 3.2.4 配置选项
- `worker_processes`：设置工作进程数量
- `worker_connections`：设置每个工作进程的最大连接数
- `worker_cpu_affinity`：设置工作进程与 CPU 核心的绑定关系

### 3.3 性能优化

#### 3.3.1 功能描述
Nginx 通过多种机制优化性能，支持高并发、低延迟的请求处理。

#### 3.3.2 核心机制
- **事件驱动架构**：采用事件驱动模型处理请求，避免阻塞
- **异步非阻塞 I/O**：使用异步 I/O 模型提高并发处理能力
- **高效事件模型**：支持 epoll（Linux）、kqueue（BSD）等高效事件模型
- **内存池管理**：通过内存池减少内存分配和释放开销

#### 3.3.3 性能指标
- **高并发连接处理**：支持 50,000+ 并发连接
- **低内存占用**：每个连接占用约 2.5KB 内存
- **高吞吐量**：在现代硬件上可达到数十万请求/秒的处理能力

### 3.4 资源管理

#### 3.4.1 功能描述
Nginx 提供精细的资源管理机制，可以控制内存、文件描述符等系统资源的使用。

#### 3.4.2 资源控制
- **内存使用优化**：通过内存池和预分配机制优化内存使用
- **文件描述符复用**：通过事件模型高效复用文件描述符
- **连接池管理**：维护与后端服务器的连接池，减少连接建立开销
- **请求缓冲区控制**：通过配置指令控制请求和响应缓冲区大小

#### 3.4.3 配置选项
- `worker_rlimit_nofile`：设置工作进程的最大文件描述符数量
- `worker_rlimit_sigpending`：设置工作进程的最大信号队列长度
- `multi_accept`：允许工作进程一次性接受多个新连接

## 4. 安全特性

### 4.1 访问保护

#### 4.1.1 功能描述
Nginx 提供多种访问保护机制，防止恶意访问和攻击。

#### 4.1.2 保护机制
- **IP 黑白名单控制**：通过 allow/deny 指令控制 IP 访问
- **请求频率限制**：通过 limit_req 模块限制请求频率
- **连接数限制**：通过 limit_conn 模块限制连接数
- **请求大小限制**：通过 client_max_body_size 限制请求体大小

#### 4.1.3 配置选项
- `limit_req_zone`：定义请求限制区域
- `limit_req`：应用请求限制
- `limit_conn_zone`：定义连接限制区域
- `limit_conn`：应用连接限制

### 4.2 协议安全

#### 4.2.1 功能描述
Nginx 提供多种协议安全机制，保护数据传输安全。

#### 4.2.2 安全特性
- **SSL/TLS 加密传输**：通过 SSL/TLS 协议保护数据传输
- **客户端证书验证**：验证客户端证书，实现双向认证
- **OCSP 装订**：通过 OCSP 装订提高证书验证效率
- **HSTS 支持**：强制客户端使用 HTTPS 连接

#### 4.2.3 配置选项
- `ssl_verify_client`：启用客户端证书验证
- `ssl_verify_depth`：设置证书链验证深度
- `ssl_client_certificate`：指定受信任的 CA 证书
- `ssl_stapling`：启用 OCSP 装订

### 4.3 攻击防护

#### 4.3.1 功能描述
Nginx 提供多种攻击防护机制，防止常见的 Web 攻击。

#### 4.3.2 防护机制
- **防止缓冲区溢出**：通过严格的边界检查防止缓冲区溢出
- **防止 SQL 注入**：通过请求过滤和验证防止 SQL 注入攻击
- **防止跨站脚本攻击（XSS）**：通过内容安全策略等机制防止 XSS 攻击
- **防止 CSRF 攻击**：通过 Referer 检查等机制防止 CSRF 攻击

#### 4.3.3 配置选项
- `add_header`：添加安全相关响应头
- `more_set_headers`：通过第三方模块设置响应头
- `secure_link`：实现安全链接保护

## 5. 邮件代理服务

### 5.1 IMAP/POP3 代理

#### 5.1.1 功能描述
Nginx 可以作为 IMAP/POP3 代理服务器，提供邮件访问代理服务。

#### 5.1.2 核心特性
- **IMAP 协议代理**：支持 IMAP4 协议代理
- **POP3 协议代理**：支持 POP3 协议代理
- **SSL/TLS 加密传输**：支持 STARTTLS 和 SSL/TLS 加密
- **外部 HTTP 认证**：通过 HTTP 接口进行用户认证

#### 5.1.3 配置选项
- `imap_capabilities`：设置 IMAP 服务器能力
- `pop3_capabilities`：设置 POP3 服务器能力
- `auth_http`：指定 HTTP 认证服务器地址
- `starttls`：配置 STARTTLS 支持

### 5.2 SMTP 代理

#### 5.2.1 功能描述
Nginx 可以作为 SMTP 代理服务器，提供邮件发送代理服务。

#### 5.2.2 核心特性
- **SMTP 协议代理**：支持 SMTP 协议代理
- **内部 SMTP 代理服务**：支持 XCLIENT 命令和客户端信息传递
- **外部认证服务器集成**：通过 HTTP 接口进行用户认证
- **邮件路由和转发**：根据配置规则进行邮件路由

#### 5.2.3 配置选项
- `smtp_capabilities`：设置 SMTP 服务器能力
- `xclient`：启用 XCLIENT 命令支持
- `smtp_auth`：配置 SMTP 认证方式
- `smtp_client_buffer`：设置 SMTP 客户端缓冲区大小

## 6. 模块化架构

### 6.1 核心模块

#### 6.1.1 功能描述
Nginx 采用模块化架构，核心功能通过模块实现。

#### 6.1.2 模块类型
- **HTTP 核心模块**：提供 HTTP 协议处理基础功能
- **事件模块**：提供事件处理机制
- **邮件核心模块**：提供邮件协议处理基础功能

#### 6.1.3 核心模块列表
- `ngx_http_core_module`：HTTP 核心模块
- `ngx_http_log_module`：HTTP 日志模块
- `ngx_http_upstream_module`：HTTP 上游模块
- `ngx_event_core_module`：事件核心模块
- `ngx_mail_core_module`：邮件核心模块

### 6.2 HTTP 模块

#### 6.2.1 功能描述
HTTP 模块提供各种 HTTP 相关功能。

#### 6.2.2 模块分类
- **标准 HTTP 模块**：随 Nginx 发行版提供的标准模块
- **可选 HTTP 模块**：需要在编译时显式启用的模块
- **第三方模块**：由社区开发的第三方模块

#### 6.2.3 常用 HTTP 模块
- `ngx_http_proxy_module`：反向代理模块
- `ngx_http_fastcgi_module`：FastCGI 模块
- `ngx_http_ssl_module`：SSL/TLS 模块
- `ngx_http_gzip_module`：Gzip 压缩模块
- `ngx_http_rewrite_module`：URL 重写模块

### 6.3 扩展性

#### 6.3.1 功能描述
Nginx 提供良好的扩展性，支持自定义模块开发。

#### 6.3.2 扩展机制
- **丰富的第三方模块生态系统**：社区提供了大量第三方模块
- **自定义模块开发支持**：提供 API 和文档支持自定义模块开发
- **模块按需加载和编译**：可以根据需要选择编译的模块

#### 6.3.3 开发支持
- **模块开发文档**：提供详细的模块开发指南
- **API 稳定性**：保持模块 API 的稳定性
- **示例模块**：提供示例模块代码帮助开发者入门

## 7. 配置和管理

### 7.1 配置文件

#### 7.1.1 功能描述
Nginx 使用结构化的配置文件进行配置管理。

#### 7.1.2 配置语法
- **结构化配置语法**：采用块结构和指令形式的配置语法
- **变量和表达式支持**：支持内置变量和简单的表达式
- **配置继承和覆盖**：支持配置的继承和覆盖机制
- **配置文件包含**：通过 include 指令包含其他配置文件

#### 7.1.3 配置指令
- `include`：包含其他配置文件
- `upstream`：定义上游服务器
- `server`：定义虚拟主机
- `location`：定义 URL 匹配规则

### 7.2 监控和统计

#### 7.2.1 功能描述
Nginx 提供监控和统计功能，帮助管理员了解服务器运行状态。

#### 7.2.2 核心特性
- **内置状态页面**：通过 stub_status 模块提供基本状态信息
- **实时活动连接监控**：实时显示活动连接数和请求处理情况
- **请求统计信息**：统计处理的请求数量和状态
- **第三方监控模块支持**：支持通过第三方模块提供更详细的监控信息

#### 7.2.3 配置选项
- `stub_status`：启用状态页面
- `status_zone`：定义状态区域
- `zone`：在 upstream 块中定义共享内存区域

### 7.3 错误处理

#### 7.3.1 功能描述
Nginx 提供完善的错误处理机制，可以自定义错误页面和处理方式。

#### 7.3.2 错误处理机制
- **自定义错误页面**：根据不同错误状态码显示不同的错误页面
- **错误代码重定向**：将特定错误重定向到指定 URI
- **错误日志记录**：详细记录错误信息到错误日志
- **错误响应格式化**：支持自定义错误响应格式

#### 7.3.3 配置选项
- `error_page`：定义错误页面
- `recursive_error_pages`：启用递归错误页面处理
- `msie_padding`：为 MSIE 浏览器添加错误页面填充

## 8. 跨平台支持

### 8.1 操作系统兼容性

#### 8.1.1 功能描述
Nginx 支持多种操作系统平台。

#### 8.1.2 支持的操作系统
- **Linux 系列**：支持各种 Linux 发行版
- **BSD 系列**：支持 FreeBSD、OpenBSD 等 BSD 系统
- **macOS**：支持苹果 macOS 系统
- **Windows**：有限支持 Windows 系统

### 8.2 架构支持

#### 8.2.1 功能描述
Nginx 支持多种 CPU 架构。

#### 8.2.2 支持的架构
- **x86/x64 架构**：支持 Intel 和 AMD 的 32 位和 64 位处理器
- **ARM 架构**：支持 ARM 处理器
- **其他主流 CPU 架构**：支持 PowerPC、SPARC 等其他架构

## 9. 其他高级功能

### 9.1 A/B 测试

#### 9.1.1 功能描述
Nginx 支持 A/B 测试，可以将流量分配到不同的后端服务。

#### 9.1.2 核心特性
- **基于权重的流量分割**：根据权重将流量分配到不同后端
- **用户特征分流**：根据用户特征（如 IP、User-Agent）进行分流
- **实验组控制**：支持创建和管理多个实验组

#### 9.1.3 实现方式
- **split_clients 模块**：通过变量值进行流量分割
- **map 模块**：根据条件映射变量值
- **upstream 权重**：通过 upstream 权重控制流量分配

### 9.2 GeoIP 支持

#### 9.2.1 功能描述
Nginx 支持基于地理位置的访问控制和服务定制。

#### 9.2.2 核心特性
- **基于地理位置的访问控制**：根据用户地理位置控制访问权限
- **地理位置信息获取**：获取用户所在国家、地区、城市等信息
- **国家/地区定向内容**：根据不同地理位置提供不同内容

#### 9.2.3 配置选项
- `geoip_country`：指定国家数据库文件
- `geoip_city`：指定城市数据库文件
- `geo`：定义基于 IP 的地理位置变量

### 9.3 图像处理

#### 9.3.1 功能描述
Nginx 支持基本的图像处理功能。

#### 9.3.2 核心特性
- **图像缩放**：支持调整图像尺寸
- **图像裁剪**：支持裁剪图像区域
- **图像格式转换**：支持基本的图像格式转换

#### 9.3.3 实现方式
- **第三方模块**：通过第三方模块实现图像处理功能

### 9.4 WebSocket 支持

#### 9.4.1 功能描述
Nginx 提供 WebSocket 协议支持，可以代理 WebSocket 连接。

#### 9.4.2 核心特性
- **WebSocket 代理**：支持 WebSocket 协议代理
- **WebSocket 负载均衡**：支持多个 WebSocket 后端的负载均衡
- **WebSocket 连接保持**：保持 WebSocket 连接的持久性

#### 9.4.3 配置选项
- `upgrade`：支持 WebSocket 协议升级
- `connection`：设置 Connection 头部
- `proxy_read_timeout`：设置 WebSocket 读取超时时间

这些功能使得 Nginx 成为了现代 Web 服务架构中的重要组成部分，广泛应用于网站托管、反向代理、负载均衡、API 网关等各种场景。